# HTTP Module TODO

## Immediate Fixes & Improvements
- [x] **Request Parsing Robustness**:
    - `cwist_http_parse_request` now uses `strtok_r`, splits the query string off `req->path`, and feeds the raw query into `cwist_query_map_parse` (liburiparser) for percent-decoding.
    - Documented in `docs/api/http.md` under *cwist_http_request_create/parse*.
- [x] **Partial Read Handling**:
    - `cwist_http_receive_request` polls until `\r\n\r\n`, enforces `CWIST_HTTP_MAX_HEADER_SIZE`, buffers bodies until `Content-Length` is satisfied, and keeps leftovers for the next keep-alive request (see docs/api/http.md).

## Core Features
- [x] **Router**:
    - `cwist_mux_router` + `cwist_app_get/post/ws` register handlers by method+path and `match_path` supports `:param` extraction documented in docs/api/app.md.
- [x] **Static File Serving**:
    - `cwist_http_response_send_file` + `cwist_app_static` cover MIME detection, traversal protection, and HEAD-aware `Content-Length`.
- [ ] **Chunked Transfer Encoding**:
    - Support `Transfer-Encoding: chunked` for both request parsing and response sending, allowing streaming of large bodies.

## Architectural Improvements
- [ ] **Event-Driven Architecture**:
    - `cwist_http_server_loop` still runs handlers synchronously even when the acceptor is epoll/kqueue driven.
    - Refactor to register client FDs with the event loop for true non-blocking I/O (Reactor pattern) and reuse the keep-alive read buffer there.
- [x] **Middleware Support**:
    - `cwist_app_use` exposes a middleware chain plus built-ins (request-id, access log, rate limit) per docs/api/middleware.md.

## Future / Long-term
- [x] **HTTPS Support**: OpenSSL-backed transport (`cwist_https_*`) is implemented and documented (docs/api/https.md).
- [x] **Timeouts**: Header/body reads and response writes now use `poll()` with `CWIST_HTTP_TIMEOUT_MS` to prevent slowloris.
- [ ] **Multipart/Form-data**: Support for file uploads.
